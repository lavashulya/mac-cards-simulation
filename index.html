<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∞–º–æ—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --color-mint: #D1F2EB;
            --color-cream: #FBF8F3;
            --color-brown: #8B6F47;
            --color-dark: #3D3D3D;
            --color-accent: #7CB9A3;
            --color-light-gray: #F5F5F5;
            --transition: 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--color-cream) 0%, var(--color-mint) 100%);
            color: var(--color-dark);
            min-height: 100vh;
            padding: 0;
        }

        /* ============= HEADER ============= */
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .logo {
            font-size: 24px;
            font-weight: 600;
            color: var(--color-brown);
            letter-spacing: -0.5px;
        }

        .header-buttons {
            display: flex;
            gap: 15px;
        }

        /* ============= MAIN CONTAINER ============= */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr 3fr;
            gap: 30px;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            header {
                flex-direction: column;
                gap: 15px;
            }
        }

        /* ============= SIDEBAR ============= */
        .sidebar {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .sidebar h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-brown);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .modules-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .module-item {
            padding: 15px;
            border-radius: 10px;
            background: var(--color-light-gray);
            cursor: pointer;
            transition: all var(--transition);
            font-size: 14px;
            font-weight: 500;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .module-item:hover:not(.locked) {
            background: var(--color-mint);
            transform: translateX(4px);
        }

        .module-item.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .module-item.active {
            background: var(--color-accent);
            color: white;
            box-shadow: 0 4px 12px rgba(124, 185, 163, 0.3);
        }

        .module-icon {
            font-size: 18px;
        }

        .reports-list {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--color-light-gray);
        }

        .report-item {
            padding: 10px;
            margin-bottom: 8px;
            background: #FFF9F0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: all var(--transition);
        }

        .report-item:hover {
            background: #FFE8D6;
            transform: translateX(2px);
        }

        /* ============= MAIN CONTENT ============= */
        .main-content {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .module-header {
            margin-bottom: 40px;
            text-align: center;
        }

        .module-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--color-brown);
            margin-bottom: 10px;
        }

        .module-description {
            font-size: 16px;
            color: var(--color-dark);
            opacity: 0.7;
            line-height: 1.6;
        }

        /* ============= PROGRESS BAR ============= */
        .progress-section {
            margin-bottom: 40px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--color-light-gray);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-accent), var(--color-mint));
            transition: width var(--transition);
        }

        .progress-text {
            font-size: 13px;
            color: var(--color-brown);
            font-weight: 600;
        }

        /* ============= EXERCISE ============= */
        .exercise {
            margin-bottom: 50px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(209, 242, 235, 0.3) 0%, rgba(251, 248, 243, 0.5) 100%);
            border-radius: 12px;
            border-left: 4px solid var(--color-accent);
        }

        .exercise-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--color-brown);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exercise-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: var(--color-accent);
            color: white;
            border-radius: 50%;
            font-size: 14px;
            font-weight: 600;
        }

        /* ============= QUESTION ============= */
        .question-group {
            margin-bottom: 30px;
        }

        .question-label {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .question-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: var(--color-mint);
            color: var(--color-brown);
            border-radius: 50%;
            font-size: 12px;
            font-weight: 600;
        }

        /* ============= CARD GALLERY ============= */
.cards-gallery {
  display: grid;
  grid-template-columns: repeat(4, 1fr); /* 4 –∫–∞—Ä—Ç—ã –≤ —Ä—è–¥ */
  gap: 16px;
  margin-bottom: 20px;
  max-height: 70vh;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 10px;
  background: var(--color-light-gray);
  border-radius: 10px;
}

.card {
  position: relative;
  cursor: pointer;
  transition: all var(--transition);
  border-radius: 12px;
  overflow: hidden;
  background: white;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

        .card:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }

.card img {
  width: 100%;
  height: 230px;       /* –º–æ–∂–Ω–æ 230‚Äì260, —á—Ç–æ–±—ã –±—ã–ª–∏ –∫—Ä—É–ø–Ω–µ–µ */
  object-fit: cover;
  display: block;
}

        .card-checkbox {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .card.selected {
            border: 3px solid var(--color-accent);
            box-shadow: 0 0 0 2px white, 0 0 0 4px var(--color-accent);
        }

        .card-label {
            padding: 8px;
            font-size: 12px;
            font-weight: 500;
            text-align: center;
            color: var(--color-brown);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ============= TEXTAREA ============= */
        .insights-group {
            margin-top: 15px;
        }

        .insights-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--color-brown);
            margin-bottom: 10px;
            display: block;
        }

        textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid var(--color-mint);
            border-radius: 10px;
            font-family: inherit;
            font-size: 14px;
            color: var(--color-dark);
            resize: vertical;
            transition: border-color var(--transition);
        }

        textarea:focus {
            outline: none;
            border-color: var(--color-accent);
            box-shadow: 0 0 0 3px rgba(124, 185, 163, 0.1);
        }

        /* ============= BUTTONS ============= */
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: var(--color-accent);
            color: white;
            flex: 1;
            min-width: 150px;
        }

        .btn-primary:hover {
            background: #6B9C88;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(124, 185, 163, 0.3);
        }

        .btn-secondary {
            background: var(--color-light-gray);
            color: var(--color-brown);
        }

        .btn-secondary:hover {
            background: var(--color-mint);
            transform: translateY(-2px);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 12px;
        }

        /* ============= VIEWS ============= */
        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* ============= HOME VIEW ============= */
        .home-view {
            text-align: center;
            padding: 60px 20px;
        }

        .home-hero {
            margin-bottom: 50px;
        }

        .home-hero h1 {
            font-size: 36px;
            font-weight: 700;
            color: var(--color-brown);
            margin-bottom: 15px;
        }

        .home-hero p {
            font-size: 18px;
            color: var(--color-dark);
            opacity: 0.7;
            max-width: 500px;
            margin: 0 auto 30px;
            line-height: 1.6;
        }

        .home-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-large {
            padding: 16px 40px;
            font-size: 16px;
        }

        /* ============= REPORT VIEW ============= */
        .report-view {
            background: white;
        }

        .report-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid var(--color-light-gray);
        }

        .report-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--color-brown);
            margin-bottom: 10px;
        }

        .report-subtitle {
            font-size: 16px;
            color: var(--color-dark);
            opacity: 0.6;
        }

        .report-content {
            margin-bottom: 40px;
        }

        .report-item-section {
            margin-bottom: 40px;
            padding-bottom: 40px;
            border-bottom: 1px solid var(--color-light-gray);
        }

        .report-item-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--color-brown);
            margin-bottom: 15px;
        }

        .report-answers {
            margin-top: 20px;
        }

        .report-answer {
            margin-bottom: 15px;
            padding: 15px;
            background: var(--color-light-gray);
            border-radius: 8px;
        }

        .report-answer-label {
            font-weight: 600;
            color: var(--color-brown);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .report-answer-text {
            color: var(--color-dark);
            line-height: 1.6;
        }

        .report-card-preview {
            width: 100px;
            height: 150px;
            margin: 10px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .report-card-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* ============= MODAL ============= */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

.modal-content { 
	background: white; 
	border-radius: 16px; 
	padding: 30px; 
	max-width: 900px; /* –±—ã–ª–æ 600, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º */ 
	width: 100%; max-height: 90vh; 
	overflow-y: auto; 
	box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); 
	position: relative; 
	padding-top: 50px; 
}
		
.modal-close { 
	position: absolute; 
	top: 16px; 
	right: 20px; 
	font-size: 22px; 
	cursor: pointer; 
	color: var(--color-dark); 
	line-height: 1; 
}
		
.modal-footer { 
	margin-top: 20px; 
	display: flex; 
	justify-content: flex-end; 
}
		
.modal-footer .btn-primary { 
	max-width: 200px; 
}


        /* ============= SCROLLBAR ============= */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--color-light-gray);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--color-accent);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #6B9C88;
        }

        /* ============= PRINT ============= */
        @media print {
            body {
                background: white;
            }
            .sidebar, header, .button-group {
                display: none;
            }
            .main-content {
                box-shadow: none;
                padding: 0;
            }
			.highlight-question {
  box-shadow: 0 0 0 3px rgba(255, 197, 120, 0.8);
  border-radius: 12px;
  background: #fffaf1;
}

        }
    </style>
	   <script src="modules.js"></script>
  
</head>
<body>
    <header>
		<button class="logo"
          type="button"
          onclick="app.goHome()"
          style="background:none; border:none; padding:0; cursor:pointer; text-align:left;">
    –ú–æ—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
  		</button>

  		<div class="header-buttons">
    	<button class="btn-secondary btn-small" onclick="app.goHome()">‚Üê –î–æ–º–æ–π</button>
  		</div>
    </header>

	<!-- –ù–û–í–´–ô –ë–õ–û–ö –î–õ–Ø –ú–û–î–£–õ–ï–ô -->
<div id="modulesScreen">
  <!-- —Å—é–¥–∞ JS –ø–æ—Ç–æ–º –ø–æ–¥—Å—Ç–∞–≤–∏—Ç –º–æ–¥—É–ª–∏ -->
</div>

    <div class="container">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <h3>üìö –ú–æ–¥—É–ª–∏</h3>
            <div class="modules-grid" id="modulesGrid"></div>

            <div class="reports-list">
                <h3>üìã –û—Ç—á—ë—Ç—ã</h3>
                <div id="reportsList"></div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- HOME VIEW -->
            <div class="view active home-view" id="homeView">
                <div class="home-hero">
                    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
                    <p>–ù–∞—á–Ω–∏—Ç–µ –ø—É—Ç—å —Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏—è —á–µ—Ä–µ–∑ –º–µ—Ç–∞—Ñ–æ—Ä–∏—á–µ—Å–∫–∏–µ –∫–∞—Ä—Ç—ã "–û—Å–æ–∑–Ω–∞–Ω–Ω—ã–µ —Å–Ω–æ–≤–∏–¥–µ–Ω–∏—è". –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –≥–ª—É–±–∂–µ –ø–æ–Ω—è—Ç—å —Å–µ–±—è, —Å–≤–æ–∏ —Ü–µ–ª–∏ –∏ –º–æ—Ç–∏–≤–∞—Ü–∏—é.</p>
                    <div class="home-buttons">
                        <button class="btn-primary btn-large" onclick="app.startModule(0)">–ù–∞—á–∞—Ç—å –ø–µ—Ä–≤—ã–π –º–æ–¥—É–ª—å ‚Üí</button>
                    </div>
                </div>
            </div>

            <!-- MODULE VIEW -->

            <!-- QUESTION VIEW: –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å –Ω–∞ —ç–∫—Ä–∞–Ω -->
            <div class="view question-view" id="questionView" style="display:none;">
                <div class="module-header">
                    <div class="breadcrumbs" id="questionBreadcrumbs"></div>
                    <h1 class="module-title" id="questionTitle"></h1>
                </div>

                <div class="progress-section">
                    <div class="progress-bar">
                        <div class="progress-fill" id="questionProgressFill"></div>
                    </div>
                    <div class="progress-text" id="questionProgressText"></div>
                </div>

                <div class="question-layout">
                    <div class="question-card-block">
                        <h3 id="questionText"></h3>
                        <div id="questionCardArea">
                            <!-- —Å—é–¥–∞ –ø–æ–∑–∂–µ –¥–æ–±–∞–≤–∏–º –≤—ã–±–æ—Ä –∫–∞—Ä—Ç—ã -->
                        </div>
                    </div>

                    <div class="question-insight-block">
                        <label class="insights-label">–í–∞—à –∏–Ω—Å–∞–π—Ç</label>
                        <textarea id="questionInsight"
                                  placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –º—ã—Å–ª–∏, –æ—â—É—â–µ–Ω–∏—è, –∏–Ω—Å–∞–π—Ç—ã..."></textarea>
                    </div>
                </div>

                <div class="button-group">
                    <button type="button" class="btn-secondary" onclick="app.exitQuestionView()">‚Üê –ö –º–æ–¥—É–ª—é</button>
                    <button type="button" class="btn-primary" onclick="app.nextQuestionInLesson()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –¥–∞–ª–µ–µ ‚Üí</button>
                </div>
            </div>

			
            <div class="view module-view" id="moduleView">
                <div class="module-header">
                    <h1 class="module-title" id="moduleTitle"></h1>
                    <p class="module-description" id="moduleDescription"></p>
                </div>

                <div class="progress-section">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText"></div>
                </div>

                <form id="moduleForm"></form>

                <div class="button-group">
                    <button class="btn-secondary" onclick="app.previousModule()">‚Üê –ù–∞–∑–∞–¥</button>
                    <button class="btn-primary" onclick="app.nextModule()">–î–∞–ª–µ–µ ‚Üí</button>
                </div>
            </div>

            <!-- REPORT VIEW -->
            <div class="view report-view" id="reportView">
                <div id="reportContent"></div>
                <div class="button-group">
                    <button class="btn-primary" onclick="app.downloadReport()">üì• –°–∫–∞—á–∞—Ç—å PDF</button>
                    <button class="btn-secondary" onclick="app.goHome()">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è</button>
                </div>
            </div>
        </main>
    </div>

<!-- CARD SELECTOR MODAL -->
<div class="modal" id="cardModal">
  <div class="modal-content">
    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
    <div style="position:absolute; top:16px; left:20px; display:flex; align-items:center; gap:8px;">
      <button type="button" id="cardBackButton" class="btn-secondary btn-small" style="display:none; padding:6px 10px;">
        ‚Üê –ù–∞–∑–∞–¥
      </button>
    </div>
    <span class="modal-close" onclick="app.closeCardModal()">‚úï</span>

    <!-- –†–µ–∂–∏–º —Å–ø–∏—Å–∫–∞ –∫–∞—Ä—Ç -->
    <div id="cardListView">
      <h2 style="margin-bottom:16px; color:var(--color-brown);">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç—É</h2>
      <div id="cardGallery" class="cards-gallery"></div>
    </div>

    <!-- –†–µ–∂–∏–º –æ–¥–Ω–æ–π –∫–∞—Ä—Ç—ã -->
<div id="cardDetailView" style="display:none; text-align:center;">
  <h2 id="cardPreviewTitle" style="margin-bottom:16px; color:var(--color-brown);"></h2>
  <div id="cardPreview" style="margin:0 auto 20px; max-width:400px;">
    <img id="cardPreviewImg" src="" alt="" style="width:100%; border-radius:16px; box-shadow:0 8px 24px rgba(0,0,0,0.2);">
  </div>

  <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã–±—Ä–∞—Ç—å -->
  <button type="button" class="btn-primary" id="cardChooseButton" onclick="app.confirmCardSelection()">
    –í—ã–±—Ä–∞—Ç—å
  </button>

  <!-- –ü–æ–ª–µ –¥–ª—è –∏–Ω—Å–∞–π—Ç–∞ –∏ –∫–Ω–æ–ø–∫–∞ –ì–æ—Ç–æ–≤–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç—ã) -->
  <div id="cardInsightBlock" style="margin-top:20px; display:none; max-width:480px; margin-left:auto; margin-right:auto; text-align:left;">
    <label style="display:block; margin-bottom:8px; font-weight:500; color:var(--color-brown);">
      –í–∞—à –∏–Ω—Å–∞–π—Ç –ø–æ —ç—Ç–æ–π –∫–∞—Ä—Ç–µ:
    </label>
    <textarea id="cardInsightTextarea" rows="4" style="width:100%; padding:10px 12px; border-radius:12px; border:1px solid #ddd; resize:vertical;"></textarea>
    <button type="button" class="btn-secondary" style="margin-top:12px;" onclick="app.finishCardInsight()">
      –ì–æ—Ç–æ–≤–æ
    </button>
  </div>
</div>






    <script>
        // ============= –ö–ê–†–¢–´ –ò–ó –†–ï–ê–õ–¨–ù–´–• –§–ê–ô–õ–û–í =============
        // –í—Å–µ —Å—Å—ã–ª–∫–∏ S3 –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ "Osoznannye-snovedeniia-*.jpg"
        // –ö–û–î –î–õ–Ø –ó–ê–ì–†–£–ó–ö–ò –ö–ê–†–¢: —Å—Ç—Ä–æ–∫–∏ 600-625
       const cards_OS = [
  { id: 1,  name: "–ö–∞—Ä—Ç–∞ 1",  img: "./cards/cards_OS/card1.png" },
  { id: 2,  name: "–ö–∞—Ä—Ç–∞ 2",  img: "./cards/cards_OS/card2.png" },
  { id: 3,  name: "–ö–∞—Ä—Ç–∞ 3",  img: "./cards/cards_OS/card3.png" },
  { id: 4,  name: "–ö–∞—Ä—Ç–∞ 4",  img: "./cards/cards_OS/card4.png" },
  { id: 5,  name: "–ö–∞—Ä—Ç–∞ 5",  img: "./cards/cards_OS/card5.png" },
  { id: 6,  name: "–ö–∞—Ä—Ç–∞ 6",  img: "./cards/cards_OS/card6.png" },
  { id: 7,  name: "–ö–∞—Ä—Ç–∞ 7",  img: "./cards/cards_OS/card7.png" },
  { id: 8,  name: "–ö–∞—Ä—Ç–∞ 8",  img: "./cards/cards_OS/card8.png" },
  { id: 9,  name: "–ö–∞—Ä—Ç–∞ 9",  img: "./cards/cards_OS/card9.png" },
  { id: 10, name: "–ö–∞—Ä—Ç–∞ 10", img: "./cards/cards_OS/card10.png" },
  { id: 11, name: "–ö–∞—Ä—Ç–∞ 11", img: "./cards/cards_OS/card11.png" },
  { id: 12, name: "–ö–∞—Ä—Ç–∞ 12", img: "./cards/cards_OS/card12.png" },
  { id: 13, name: "–ö–∞—Ä—Ç–∞ 13", img: "./cards/cards_OS/card13.png" },
  { id: 14, name: "–ö–∞—Ä—Ç–∞ 14", img: "./cards/cards_OS/card14.png" },
  { id: 15, name: "–ö–∞—Ä—Ç–∞ 15", img: "./cards/cards_OS/card15.png" },
  { id: 16, name: "–ö–∞—Ä—Ç–∞ 16", img: "./cards/cards_OS/card16.png" },
  { id: 17, name: "–ö–∞—Ä—Ç–∞ 17", img: "./cards/cards_OS/card17.png" },
  { id: 18, name: "–ö–∞—Ä—Ç–∞ 18", img: "./cards/cards_OS/card18.png" },
  { id: 19, name: "–ö–∞—Ä—Ç–∞ 19", img: "./cards/cards_OS/card19.png" },
  { id: 20, name: "–ö–∞—Ä—Ç–∞ 20", img: "./cards/cards_OS/card20.png" },
  { id: 21, name: "–ö–∞—Ä—Ç–∞ 21", img: "./cards/cards_OS/card21.png" },
  { id: 22, name: "–ö–∞—Ä—Ç–∞ 22", img: "./cards/cards_OS/card22.png" },
  { id: 23, name: "–ö–∞—Ä—Ç–∞ 23", img: "./cards/cards_OS/card23.png" },
  { id: 24, name: "–ö–∞—Ä—Ç–∞ 24", img: "./cards/cards_OS/card24.png" },
  { id: 25, name: "–ö–∞—Ä—Ç–∞ 25", img: "./cards/cards_OS/card25.png" },
  { id: 26, name: "–ö–∞—Ä—Ç–∞ 26", img: "./cards/cards_OS/card26.png" },
  { id: 27, name: "–ö–∞—Ä—Ç–∞ 27", img: "./cards/cards_OS/card27.png" },
  { id: 28, name: "–ö–∞—Ä—Ç–∞ 28", img: "./cards/cards_OS/card28.png" },
  { id: 29, name: "–ö–∞—Ä—Ç–∞ 29", img: "./cards/cards_OS/card29.png" },
  { id: 30, name: "–ö–∞—Ä—Ç–∞ 30", img: "./cards/cards_OS/card30.png" },
  { id: 31, name: "–ö–∞—Ä—Ç–∞ 31", img: "./cards/cards_OS/card31.png" },
  { id: 32, name: "–ö–∞—Ä—Ç–∞ 32", img: "./cards/cards_OS/card32.png" },
  { id: 33, name: "–ö–∞—Ä—Ç–∞ 33", img: "./cards/cards_OS/card33.png" },
  { id: 34, name: "–ö–∞—Ä—Ç–∞ 34", img: "./cards/cards_OS/card34.png" },
  { id: 35, name: "–ö–∞—Ä—Ç–∞ 35", img: "./cards/cards_OS/card35.png" },
  { id: 36, name: "–ö–∞—Ä—Ç–∞ 36", img: "./cards/cards_OS/card36.png" },
  { id: 37, name: "–ö–∞—Ä—Ç–∞ 37", img: "./cards/cards_OS/card37.png" },
  { id: 38, name: "–ö–∞—Ä—Ç–∞ 38", img: "./cards/cards_OS/card38.png" },
  { id: 39, name: "–ö–∞—Ä—Ç–∞ 39", img: "./cards/cards_OS/card39.png" },
  { id: 40, name: "–ö–∞—Ä—Ç–∞ 40", img: "./cards/cards_OS/card40.png" },
  { id: 41, name: "–ö–∞—Ä—Ç–∞ 41", img: "./cards/cards_OS/card41.png" },
  { id: 42, name: "–ö–∞—Ä—Ç–∞ 42", img: "./cards/cards_OS/card42.png" },
  { id: 43, name: "–ö–∞—Ä—Ç–∞ 43", img: "./cards/cards_OS/card43.png" },
  { id: 44, name: "–ö–∞—Ä—Ç–∞ 44", img: "./cards/cards_OS/card44.png" }
];

let cards = cards_OS;
		


        // ============= APP STATE =============

// –ê–¥–∞–ø—Ç–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã MODULES: lessons -> exercises –¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞
const ADAPTED_MODULES = MODULES.map(m => ({
    ...m,
    exercises: m.lessons || []
}));

		
        const app = {
            currentModuleId: null,
            currentExerciseId: null,
            responses: {},
            cards: cards_OS,
            currentCardInputId: null,
			currentSelectedCardId: null, // –≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä –≤ –º–æ–¥–∞–ª–∫–µ
		// ============= INIT =============

            // ============= INIT =============
            init() {
                this.loadResponses();
                this.renderModules();
                this.renderReports();
                console.log("‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å", this.cards.length, "–∫–∞—Ä—Ç–∞–º–∏ –∏–∑ S3");
            },

            // ============= MODULES =============
renderModules() {
    const grid = document.getElementById('modulesGrid');
    grid.innerHTML = ADAPTED_MODULES.map((m, i) => `
        <div class="module-item ${i > 0 && !this.isModuleUnlocked(i) ? 'locked' : ''} ${this.currentModuleId === m.id ? 'active' : ''}"
             onclick="app.startModule(${i})">
            <span>–ú–æ–¥—É–ª—å ${m.id}</span>
            <span class="module-icon">${i > 0 && !this.isModuleUnlocked(i) ? 'üîí' : '‚úì'}</span>
        </div>
    `).join('');
},


 isModuleUnlocked(index) {
    if (index === 0) return true;
    const prevModule = ADAPTED_MODULES[index - 1];
    return this.isModuleCompleted(prevModule.id);
},


            isModuleCompleted(moduleId) {
                const module = ADAPTED_MODULES.find(m => m.id === moduleId);
                if (!module) return false;
                
                return module.exercises.every(ex => 
                    ex.questions.every(q => this.responses[q.id])
                );
            },

            startModule(moduleIndex) {
               const module = ADAPTED_MODULES[moduleIndex];
                if (moduleIndex > 0 && !this.isModuleUnlocked(moduleIndex)) {
                    alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≤–µ—Ä—à–∏—Ç–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–æ–¥—É–ª—å');
                    return;
                }

                this.currentModuleId = module.id;
                this.currentExerciseId = 0;
                this.renderModule();
                this.showView('moduleView');
                this.renderModules();
            },

renderModule() {
  const module = ADAPTED_MODULES.find(m => m.id === this.currentModuleId);
  document.getElementById('moduleTitle').textContent = module.title;
  document.getElementById('moduleDescription').textContent = module.description;

  const form = document.getElementById('moduleForm');
  form.innerHTML = module.exercises.map((ex, exIdx) => `
    <div class="exercise">
      <div class="exercise-title">
        <span class="exercise-number">${exIdx + 1}</span>
        ${ex.title}
      </div>
      <p style="margin-bottom: 20px; color: #666; font-size: 14px;">${ex.description}</p>
  ${ex.questions.map((q, qIdx) => `
        <div class="question-group"
             data-question-id="${q.id}"
             onclick="app.openQuestionView(${exIdx}, ${qIdx})"
             style="cursor:pointer;">
          <label class="question-label">
            <span class="question-number">${qIdx + 1}</span>
            ${q.text}
          </label>

          ${q.cardRequired ? `
            <div style="margin-bottom: 15px;">
              <button type='button' class='btn-secondary' onclick='app.openCardModal("${q.id}")'>
                üìÇ –í—ã–±—Ä–∞—Ç—å –∫–∞—Ä—Ç—É
              </button>
              <div id="selected-${q.id}" style="margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap;"></div>
            </div>
          ` : ''}
          <div class="insights-group">
            <label class="insights-label">–í–∞—à–∏ –∏–Ω—Å–∞–π—Ç—ã:</label>
            <textarea id="text-${q.id}" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –º—ã—Å–ª–∏, –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è, —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è...">${this.responses[q.id]?.text || ''}</textarea>
          </div>
        </div>
      `).join('')}
    </div>
  `).join('');

  // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–±–æ—Ä –∫–∞—Ä—Ç
  this.restoreSelectedCards();
},

restoreSelectedCards() {
  const module = ADAPTED_MODULES.find(m => m.id === this.currentModuleId);
  if (!module || !Array.isArray(module.exercises)) return;

  module.exercises.forEach(ex => {
    if (!ex.questions) return;
    ex.questions.forEach(q => {
      const selected = this.responses[q.id]?.cards || [];
      const container = document.getElementById(`selected-${q.id}`);
      if (container) {
        container.innerHTML = selected.map(cardId => {
          const card = cards.find(c => c.id === cardId);
          if (!card) return '';
          return `
            <div class="report-card-preview" style="position: relative;">
              <img src="${card.img}" alt="${card.name}">
              <button type="button" class="btn-small" style="position: absolute; top: 2px; right: 2px; padding: 2px 4px;" onclick="app.removeCard('${q.id}', ${cardId})">‚úï</button>
            </div>
          `;
        }).join('');
      }
    });
  });
},


// ===== –≠–ö–†–ê–ù –û–¢–î–ï–õ–¨–ù–û–ì–û –í–û–ü–†–û–°–ê =====
openQuestionView(exerciseIndex, questionIndex) {
    const module = ADAPTED_MODULES.find(m => m.id === this.currentModuleId);
    if (!module || !module.exercises[exerciseIndex]) return;

    const exercise = module.exercises[exerciseIndex];
    const question = exercise.questions[questionIndex];
    if (!question) return;

    // —Ö–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏
    const bc = document.getElementById('questionBreadcrumbs');
    if (bc) {
        bc.textContent = `${module.title} ‚Üí ${exercise.title} ‚Üí –í–æ–ø—Ä–æ—Å ${questionIndex + 1}`;
    }

    // –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç
    const titleEl = document.getElementById('questionTitle');
    const textEl = document.getElementById('questionText');
    if (titleEl) titleEl.textContent = exercise.title;
    if (textEl) textEl.textContent = question.text;

    // –ø—Ä–æ–≥—Ä–µ—Å—Å –≤–Ω—É—Ç—Ä–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
    const total = exercise.questions.length || 1;
    const current = questionIndex + 1;
    const percent = Math.round(current / total * 100);
    const pf = document.getElementById('questionProgressFill');
    const pt = document.getElementById('questionProgressText');
    if (pf) pf.style.width = percent + '%';
    if (pt) pt.textContent = `${current} / ${total} –≤–æ–ø—Ä–æ—Å–æ–≤ (${percent}%)`;

    // –∏–Ω—Å–∞–π—Ç –∏–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
    const resp = this.responses[question.id];
    const insightEl = document.getElementById('questionInsight');
    if (insightEl) insightEl.value = resp?.text || '';

    // –∑–∞–ø–æ–º–Ω–∏–º –ø–æ–∑–∏—Ü–∏—é
    this.currentExerciseId = exerciseIndex;
    this.currentQuestionIndex = questionIndex;

    // –ø–æ–∫–∞–∑–∞—Ç—å questionView, —Å–∫—Ä—ã—Ç—å moduleView
    this.showView('questionView');
},

exitQuestionView() {
    this.showView('moduleView');
},

nextQuestionInLesson() {
    const module = ADAPTED_MODULES.find(m => m.id === this.currentModuleId);
    if (!module || !module.exercises[this.currentExerciseId]) {
        this.showView('moduleView');
        return;
    }

    const exercise = module.exercises[this.currentExerciseId];
    const question = exercise.questions[this.currentQuestionIndex];
    if (!question) {
        this.showView('moduleView');
        return;
    }

    const insightEl = document.getElementById('questionInsight');
    const text = insightEl ? insightEl.value : '';

    this.responses[question.id] = {
        ...(this.responses[question.id] || {}),
        text
    };
    this.saveResponses?.();
    this.updateProgress?.();

    // –ø–æ–∫–∞ —É–ø—Ä–æ—â—ë–Ω–Ω–æ: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –º–æ–¥—É–ª—é
    this.showView('moduleView');
},



            updateProgress() {
                const module = ADAPTED_MODULES.find(m => m.id === this.currentModuleId);
                const totalQuestions = module.exercises.reduce((sum, ex) => sum + ex.questions.length, 0);
                const answeredQuestions = module.exercises.reduce((sum, ex) => {
                    return sum + ex.questions.filter(q => this.responses[q.id]).length;
                }, 0);

                const percentage = Math.round((answeredQuestions / totalQuestions) * 100);
                document.getElementById('progressFill').style.width = percentage + '%';
                document.getElementById('progressText').textContent = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${answeredQuestions}/${totalQuestions} –≤–æ–ø—Ä–æ—Å–æ–≤ (${percentage}%)`;
            },

            nextModule() {
                this.saveResponses();
    const module = ADAPTED_MODULES.find(m => m.id === this.currentModuleId);
                
                const allAnswered = module.exercises.every(ex => 
                    ex.questions.every(q => {
                        const response = this.responses[q.id];
                        return response && (response.text || response.cards?.length > 0);
                    })
                );

                if (!allAnswered) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º');
                    return;
                }

                this.createReport(this.currentModuleId);

                const currentIndex = ADAPTED_MODULES.findIndex(m => m.id === this.currentModuleId);
                if (currentIndex < MODULES.length - 1) {
                    this.startModule(currentIndex + 1);
                } else {
                    alert('üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –≤—Å–µ –º–æ–¥—É–ª–∏!');
                    this.goHome();
                }
            },

            previousModule() {
                 this.saveResponses();
    const currentIndex = ADAPTED_MODULES.findIndex(m => m.id === this.currentModuleId);
                if (currentIndex > 0) {
                    this.startModule(currentIndex - 1);
                }
            },

            // ============= RESPONSES =============
saveResponses() {
  const module = MODULES.find(m => m.id === this.currentModuleId);
  module.exercises.forEach(ex => {
    ex.questions.forEach(q => {
      const textArea = document.getElementById(`text-${q.id}`);
      if (textArea) {
        if (!this.responses[q.id]) {
          this.responses[q.id] = { text: '', cards: [] };
        }
        // –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á—Ç–æ-—Ç–æ –≤–≤—ë–ª –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–æ–ª–µ ‚Äî –±–µ—Ä—ë–º —ç—Ç–æ,
        // –∏–Ω–∞—á–µ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –±—ã–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ –º–æ–¥–∞–ª–∫–∏)
        const newText = textArea.value;
        this.responses[q.id].text = newText !== '' ? newText : (this.responses[q.id].text || '');
      }
    });
  });
  localStorage.setItem('responses', JSON.stringify(this.responses));
},


            loadResponses() {
                const saved = localStorage.getItem('responses');
                this.responses = saved ? JSON.parse(saved) : {};
            },


// ============= CARD MODAL =============

// –∏–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–π –∫–∞—Ä—Ç—ã –≤ –º–æ–¥–∞–ª–∫–µ
currentCardIndex: 0,

openCardModal(questionId) {
  this.currentCardInputId = questionId;
  this.currentCardIndex = 0;
  this.currentSelectedCardId = null;

  // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç, —Å–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∂–∏–º –¥–µ—Ç–∞–ª–∏
  const modal = document.getElementById('cardModal');
  const listView = document.getElementById('cardListView');
  const detailView = document.getElementById('cardDetailView');
  const backBtn = document.getElementById('cardBackButton');

  if (listView && detailView && backBtn) {
    listView.style.display = 'block';
    detailView.style.display = 'none';
    backBtn.style.display = 'none';
  }

  this.renderCardGallery();
  modal.classList.add('active');
},

renderCardGallery() {
  const gallery = document.getElementById('cardGallery');
  if (!gallery) return;

  gallery.innerHTML = this.cards.map((card, index) => `
    <div class="card" onclick="app.openCardDetail(${index})">
      <img src="${card.img}" alt="${card.name}" 
           onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22140%22 height=%22200%22%3E%3Crect fill=%22%23ddd%22 width=%22140%22 height=%22200%22/%3E%3Ctext x=%2270%22 y=%22100%22 text-anchor=%22middle%22 font-size=%2214%22 fill=%22%23999%22%3E–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏%3C/text%3E%3C/svg%3E'">
      <div class="card-label">${card.name}</div>
    </div>
  `).join('');
},

openCardDetail(index) {
  this.currentCardIndex = index;
  const card = this.cards[index];
  if (!card) return;

  const listView = document.getElementById('cardListView');
  const detailView = document.getElementById('cardDetailView');
  const backBtn = document.getElementById('cardBackButton');
  const img = document.getElementById('cardPreviewImg');
  const title = document.getElementById('cardPreviewTitle');

  if (!listView || !detailView || !backBtn || !img || !title) return;

  listView.style.display = 'none';
  detailView.style.display = 'block';
  backBtn.style.display = 'inline-flex';

  img.src = card.img;
  img.alt = card.name;
  title.textContent = card.name;

  this.currentSelectedCardId = card.id;
},

closeCardModal() {
  const modal = document.getElementById('cardModal');
  if (modal) modal.classList.remove('active');
  this.currentCardInputId = null;
  this.currentSelectedCardId = null;
},

confirmCardSelection() {
  const questionId = this.currentCardInputId;
  if (!questionId || !this.currentSelectedCardId) {
    return;
  }

  // —Å–æ–∑–¥–∞—ë–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞, –µ—Å–ª–∏ –µ—ë –µ—â—ë –Ω–µ—Ç
  if (!this.responses[questionId]) {
    this.responses[questionId] = { text: '', cards: [] };
  }

  // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ä—Ç—É, –Ω–æ –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É
  this.responses[questionId].cards = [this.currentSelectedCardId];

  // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å –∏–Ω—Å–∞–π—Ç–æ–º –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª–∫–∏
  const insightBlock = document.getElementById('cardInsightBlock');
  const insightTextarea = document.getElementById('cardInsightTextarea');

  if (insightBlock && insightTextarea) {
    insightBlock.style.display = 'block';
    // –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ–º —É–∂–µ –≤–≤–µ–¥—ë–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç, –µ—Å–ª–∏ –æ–Ω –±—ã–ª
    insightTextarea.value = this.responses[questionId].text || '';
    insightTextarea.focus();
  }
},

finishCardInsight() {
  const questionId = this.currentCardInputId;
  if (!questionId) {
    this.closeCardModal();
    return;
  }

  const insightTextarea = document.getElementById('cardInsightTextarea');
  const text = insightTextarea ? insightTextarea.value : '';

  if (!this.responses[questionId]) {
    this.responses[questionId] = { text: '', cards: [] };
  }

  // —Å—Ç—Ä–æ–≥–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
  this.responses[questionId].text = text;
  this.saveResponses();
  this.renderModule();
  this.closeCardModal();

  const questionBlock = document.querySelector(`[data-question-id="${questionId}"]`);
  if (questionBlock) {
    questionBlock.scrollIntoView({ behavior: 'smooth', block: 'center' });
    const textarea = questionBlock.querySelector('textarea');
    if (textarea) textarea.focus();
  }
},   // ‚Üê –∏ –Ω–∞ —ç—Ç–æ–º –º–µ—Ç–æ–¥ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è





            // ============= REPORTS =============
createReport(moduleId) {
  const module = MODULES.find(m => m.id === moduleId);
  const reportId = 'report_' + Date.now();

  // –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å–∞–º–º–∞—Ä–∏ –ø–æ –º–æ–¥—É–ª—é
  const summary = module.exercises.flatMap(ex =>
    ex.questions.map(q => ({
      questionId: q.id,
      questionText: q.text,
      cardId: (this.responses[q.id]?.cards || [])[0] || null,
      answerText: this.responses[q.id]?.text || ''
    }))
  );

  const report = {
    id: reportId,
    moduleId: moduleId,
    moduleName: module.title,
    date: new Date().toLocaleString('ru-RU'),
    summary, // –Ω–æ–≤—ã–π –º–∞—Å—Å–∏–≤ [{ questionText, cardId, answerText }]
    exercises: module.exercises.map(ex => ({
      title: ex.title,
      questions: ex.questions.map(q => ({
        id: q.id,
        text: q.text,
        response: this.responses[q.id] || {}
      }))
    }))
  };

  let reports = JSON.parse(localStorage.getItem('reports') || '[]');
  reports.push(report);
  localStorage.setItem('reports', JSON.stringify(reports));
  this.renderReports();
},


            renderReports() {
                const reportsList = document.getElementById('reportsList');
                const reports = JSON.parse(localStorage.getItem('reports') || '[]');
                reportsList.innerHTML = reports.map(r => `
                    <div class="report-item" onclick="app.showReport('${r.id}')">
                        ${r.moduleName} - ${r.date}
                    </div>
                `).join('');
            },

showReport(reportId) {
  const reports = JSON.parse(localStorage.getItem('reports') || '[]');
  const report = reports.find(r => r.id === reportId);
  if (!report) return;
  const content = document.getElementById('reportContent');

  // –ï—Å–ª–∏ –µ—Å—Ç—å summary ‚Äì –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥—É–ª—å–Ω—ã–π —Å–∞–º–º–∞—Ä–∏
  if (report.summary && Array.isArray(report.summary)) {
    content.innerHTML = `
      <div class="report-header">
        <h1 class="report-title">${report.moduleName}</h1>
        <p class="report-subtitle">${report.date}</p>
      </div>
      <div class="report-content">
        ${report.summary.map(item => {
          const card = item.cardId
            ? this.cards.find(c => c.id === item.cardId)
            : null;
          return `
            <div class="report-answer">
              <div class="report-answer-label">‚ùì ${item.questionText}</div>
              <div class="report-answer-text" style="display:flex; gap:16px; align-items:flex-start; flex-wrap:wrap;">
                ${card ? `
                  <div class="report-card-preview">
                    <img src="${card.img}" alt="${card.name}">
                  </div>` : ''}
                <div style="flex:1; min-width:200px; margin-top: 4px;">
                  ${item.answerText || '–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞'}
                </div>
              </div>
            </div>
          `;
        }).join('')}
      </div>
    `;
  } else {
    // –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç—á—ë—Ç–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    content.innerHTML = `
      <div class="report-header">
        <h1 class="report-title">${report.moduleName}</h1>
        <p class="report-subtitle">${report.date}</p>
      </div>
      <div class="report-content">
        ${report.exercises.map((ex, exIdx) => `
          <div class="report-item-section">
            <h3 class="report-item-title">${exIdx + 1}. ${ex.title}</h3>
            ${ex.questions.map(q => `
              <div class="report-answer">
                <div class="report-answer-label">‚ùì ${q.text}</div>
                <div class="report-answer-text">
                  ${q.response.cards?.map(cardId => {
                    const card = this.cards.find(c => c.id === cardId);
                    return `<div class="report-card-preview"><img src="${card.img}" alt="${card.name}"></div>`;
                  }).join('') || ''}
                  <div style="margin-top: 10px;">${q.response.text || '–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞'}</div>
                </div>
              </div>
            `).join('')}
          </div>
        `).join('')}
      </div>
    `;
  }

  this.showView('reportView');
},


            downloadReport() {
                const element = document.getElementById('reportContent');
                const opt = {
                    margin: 10,
                    filename: 'report_' + new Date().toISOString().split('T')[0] + '.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2 },
                    jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
                };
                html2pdf().set(opt).from(element).save();
            },

            // ============= NAVIGATION =============
            showView(viewName) {
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                document.getElementById(viewName).classList.add('active');
            },

            goHome() {
                this.currentModuleId = null;
                this.showView('homeView');
                this.renderModules();
            }
        };

        // ============= INIT =============
        app.init();
    </script>
</body>
</html>




































